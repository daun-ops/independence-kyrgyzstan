<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>С Днем Независимости Кыргызстана</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Lobster&family=Rubik:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body, html {
      margin: 0; padding: 0; height: 100%; overflow: hidden;
      font-family: 'Rubik', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: #d80027; /* красный фон как у флага на случай проблем с рендерингом */
    }
    /* Анимация разлёта элементов при старте */
    @keyframes flyAway {
      0% {
        transform: translate(0,0) rotate(0) scale(1);
        opacity: 1;
        filter: blur(0px);
      }
      100% {
        transform: translate(var(--tx, 0px), var(--ty, -120vh)) rotate(var(--rz, 40deg)) scale(0.8);
        opacity: 0;
        filter: blur(3px);
      }
    }
    .disperse {
      will-change: transform, opacity, filter;
      animation: flyAway 900ms ease-in forwards;
    }
    @keyframes wave {
      0% { background-position: 50% 50%; }
      50% { background-position: 52% 48%; }
      100% { background-position: 50% 50%; }
    }
    .overlay {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.4);
      z-index: 1;
    }
    /* Плавно скрываем overlay на старте вместо трансформаций (уменьшает мерцание на мобиле) */
    .overlay-fadeout {
      opacity: 0;
      transition: opacity 400ms ease;
    }
    /* Слой флага с анимацией «развевания» */
    .flag {
      position: fixed; inset: 0;
      background-color: #d80027; /* красный фон на случай, если изображение не загрузится */
      background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/c/c7/Flag_of_Kyrgyzstan.svg/1920px-Flag_of_Kyrgyzstan.svg.png');
      background-position: center;
      background-repeat: no-repeat;
      background-size: cover;
      z-index: 0;
      transform-origin: left center;
      filter: saturate(1.05) brightness(1.03);
      animation: flagWave 6s ease-in-out infinite;
      /* создаем отдельный композитный слой для предотвращения мерцаний на мобильных */
      backface-visibility: hidden;
      transform: translateZ(0);
      will-change: transform;
    }
    .flag::after {
      content: "";
      position: absolute; inset: 0;
      /* Подвижные блики/тени, создающие видимость складок */
      background: linear-gradient(
        to right,
        rgba(255,255,255,0.10) 0%,
        rgba(0,0,0,0.00) 20%,
        rgba(0,0,0,0.10) 50%,
        rgba(0,0,0,0.00) 80%,
        rgba(255,255,255,0.08) 100%
      );
      background-size: 160px 100%;
      mix-blend-mode: overlay;
      pointer-events: none;
      animation: waveLight 3s linear infinite;
      opacity: 0.55;
    }
    @keyframes flagWave {
      0%   { transform: perspective(900px) rotateY(0.8deg) skewY(0.6deg) scaleY(1.00); }
      50%  { transform: perspective(900px) rotateY(-2deg)  skewY(-1.2deg) scaleY(1.02) translateX(-6px); }
      100% { transform: perspective(900px) rotateY(0.8deg) skewY(0.6deg) scaleY(1.00); }
    }
    /* Облегченная версия анимации флага для смартфонов */
    @keyframes flagWaveLite {
      0%   { transform: perspective(900px) rotateY(0.12deg) skewY(0.10deg) scaleY(1.00); }
      50%  { transform: perspective(900px) rotateY(-0.24deg) skewY(-0.16deg) scaleY(1.005); }
      100% { transform: perspective(900px) rotateY(0.12deg) skewY(0.10deg) scaleY(1.00); }
    }
    @keyframes waveLight {
      from { background-position: 0 0; }
      to   { background-position: 320px 0; }
    }
    /* Учет системных настроек уменьшения анимации */
    @media (prefers-reduced-motion: reduce) {
      * { animation-duration: 0.001ms !important; animation-iteration-count: 1 !important; transition-duration: 0.001ms !important; }
      .flag { animation: none !important; }
      .flag::after { animation: none !important; }
    }
    .text-container {
      text-align: center;
      color: #fff;
      padding: 1rem;
      background: rgba(0,0,0,0.4);
      border-radius: 1rem;
      animation: glow 2.5s infinite alternate;
      position: relative;
      z-index: 2;
    }
    .text-container h1,
    .text-container h2 {
      font-family: 'Lobster', 'Rubik', sans-serif;
      letter-spacing: 0.5px;
      text-shadow: 0 2px 8px rgba(0,0,0,0.5);
    }
    @keyframes glow {
      from { box-shadow: 0 0 10px rgba(255, 215, 0, 0.7), 0 0 20px rgba(255, 0, 0, 0.6); }
      to { box-shadow: 0 0 25px rgba(255, 255, 0, 1), 0 0 50px rgba(255, 0, 0, 0.9); }
    }
    .confetti {
      position: fixed;
      width: 10px; height: 10px;
      background-color: red;
      top: -10px;
      animation: fall linear forwards;
    }
    @keyframes fall {
      to { transform: translateY(110vh) rotate(360deg); }
    }
    .firework {
      position: fixed;
      /* Ещё меньшие частицы, хвосты оставляем без изменений */
      width: 6px; height: 6px;
      background: yellow;
      border-radius: 50%;
      box-shadow: 0 0 18px rgba(255,255,150,0.9), 0 0 36px rgba(255,100,0,0.7);
      animation: moveexplode 1.8s ease-out forwards;
    }
    /* Светящийся хвост вдоль направления полёта */
    .firework::after {
      content: "";
      position: absolute;
      left: 50%; top: 50%;
      transform: translate(-50%, -50%) rotate(var(--angle, 0rad));
      width: var(--tail, 120px);
      height: 3px;
      background: linear-gradient(90deg, rgba(255,255,255,0.0) 0%, rgba(255,255,150,0.85) 60%, rgba(255,120,0,0.0) 100%);
      filter: blur(1px);
      opacity: 0.9;
      border-radius: 2px;
      pointer-events: none;
    }
    @keyframes moveexplode {
      0% { transform: translate(0, 0) scale(0.3); opacity: 1; }
      70% { transform: translate(var(--dx, 0), var(--dy, 0)) scale(2.5); opacity: 1; }
      100% { transform: translate(calc(var(--dx, 0) * 1.05), calc(var(--dy, 0) * 1.05)) scale(3.5); opacity: 0; }
    }
    /* Анимационный персонаж: центр экрана */
    .character {
      position: fixed;
      left: 50%; top: 50%;
      width: min(30vw, 260px);
      height: auto;
      z-index: 2; /* над overlay (1) и флагом (0), под текстом (2/3) */
      pointer-events: none;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,0.6));
      transform: translate(-50%, -50%) scale(0.94);
      will-change: transform, opacity;
    }
    /* Появиться в центре и исчезнуть */
    @keyframes popInOut {
      0%   { opacity: 0; transform: translate(-50%, -50%) scale(0.92); }
      12%  { opacity: 1; transform: translate(-50%, -50%) scale(1.00); }
      75%  { opacity: 1; transform: translate(-50%, -50%) scale(1.00); }
      100% { opacity: 0; transform: translate(-50%, -50%) scale(0.98); }
    }
    .character-pop {
      animation: popInOut 3.2s ease-out forwards;
    }
    /* Мобильные устройства: до 480px */
    @media (max-width: 480px) {
      .character { width: 46vw; }
      .text-container { padding: 0.75rem; border-radius: 0.75rem; }
      .text-container h1 { font-size: 1.6rem; }
      .text-container h2 { font-size: 1.1rem; }
      .cta-btn { padding: 0.8rem 1.2rem; font-size: 1rem; }
      /* На маленьких экранах отключаем анимацию фона с флагом */
      .flag { animation: none !important; }
      .flag::after { animation: none !important; opacity: 0.15; }
    }
    /* Стиль для кнопки-призыва к действию */
    .cta-btn {
      position: relative;
      display: inline-flex;
      align-items: center;
      gap: 0.6rem;
      padding: 1rem 1.6rem;
      border: 0;
      border-radius: 9999px;
      background: linear-gradient(135deg, #4f9cff 0%, #3a84f9 50%, #2f6df6 100%);
      color: #ffffff !important;
      font-weight: 900;
      font-size: 1.1rem;
      text-decoration: none !important;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      text-shadow: none;
      box-shadow: 0 2px 8px rgba(0, 64, 160, 0.25);
      border: 1px solid rgba(255,255,255,0.12);
      transition: transform .15s ease, box-shadow .15s ease, filter .15s ease, opacity .15s ease;
      animation: none;
      cursor: pointer;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    .cta-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 64, 160, 0.28);
      filter: brightness(1.04) saturate(1.02);
    }
    .cta-btn:active {
      transform: translateY(0);
      box-shadow: 0 2px 6px rgba(0, 64, 160, 0.22);
    }
    .cta-btn:focus-visible {
      outline: none;
      box-shadow: 0 0 0 4px rgba(59,130,246,0.35), 0 8px 16px rgba(0, 64, 160, 0.25);
    }
    /* Блик и глянец */
    .cta-btn::before, .cta-btn::after { content: none; }
    @keyframes shine {
      0% { transform: translateX(-120%) rotate(12deg); }
      40%, 100% { transform: translateX(220%) rotate(12deg); }
    }
    @keyframes pulseSoft {
      0%, 100% {
        box-shadow: 0 10px 25px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.55);
      }
      50% {
        box-shadow: 0 14px 32px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.6);
      }
    }
  </style>
</head>
<body class="flex items-center justify-center">

  <div class="flag"></div>
  <div class="overlay"></div>
  <!-- Персонаж (скрыт, пока не задан URL) -->
  <img id="character" class="character" alt="Анимационный персонаж" style="display:none" />

  <div class="text-container animate-scaleIn">
    <h1 class="text-4xl md:text-6xl font-bold animate-fadeInUp">
      С ДНЁМ НЕЗАВИСИМОСТИ
    </h1>
    <h2 class="text-2xl md:text-4xl mt-4 animate-scaleIn">
      КЫРГЫЗСТАНА 🇰🇬
    </h2>
    <button id="startBtn" type="button" aria-label="Начать праздник" class="cta-btn mt-6 text-base md:text-xl">
      начать праздник 🎉
    </button>
  </div>

  <script>
    // Изображение персонажа (PNG) с GitHub (raw URL)
    const characterUrl = 'https://raw.githubusercontent.com/daun-ops/independence-kyrgyzstan/7d002ab4dc2fe7dbd35a1d24f54b7a60d1f7c019/MVD.png';
    const characterEl = document.getElementById('character');
    if (characterEl && characterUrl) {
      characterEl.src = characterUrl; // не показываем сразу, появится после клика
    }

    // Звуки фанфар + салют
    // Аудио из репозитория GitHub (raw URL на конкретный коммит)
    const githubFanfareUrl = "https://raw.githubusercontent.com/daun-ops/independence-kyrgyzstan/6377855f91cc90fb7f1f7a8e5eda7b3205aeeb9e/arab.mp3";
    const fanfare = new Audio(githubFanfareUrl);
    const fireworkSound = new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_b99d9b76a1.mp3?filename=firework-explosion-6962.mp3");
    // Определяем маленький экран (смартфон)
    const isSmallScreen = window.matchMedia && window.matchMedia('(max-width: 480px)').matches;
    fanfare.preload = "auto"; fanfare.load();
    fireworkSound.preload = "auto"; fireworkSound.load();
    fanfare.volume = isSmallScreen ? 0.45 : 0.6;
    fireworkSound.volume = isSmallScreen ? 0.45 : 0.6;
    // Палитра цветов частиц фейерверка (можно менять под вкус)
    const FIREWORK_COLORS = [
      '#0b20de',
      '#db0b1c',
      '#f05a0a',
      '#f05a0a'
    ];

    let started = false;
    let fireworkInterval;
    let musicFireworkInterval;
    let musicBigBoomInterval;

    const startBtn = document.getElementById('startBtn');
    if (startBtn) {
      // Используем pointerup для надёжной работы на телефонах и компьютерах
      startBtn.addEventListener('pointerup', startCelebration, { once: true });
      // Фолбэк на click для некоторых браузеров/платформ
      startBtn.addEventListener('click', startCelebration, { once: true });
      // Поддержка клавиатуры (Enter/Space)
      startBtn.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          startCelebration();
        }
      }, { once: true });
    }

    function startCelebration() {
      if (started) return;
      started = true; // фиксируем старт, чтобы не было двойных вызовов

      // Вибро-отклик
      if (navigator.vibrate) { try { navigator.vibrate([120, 60, 120]); } catch(_) {} }

      // Запустить музыку и салюты (конфетти уже идёт)
      try { fanfare.currentTime = 0; fanfare.play().catch(()=>{}); } catch(_) {}
      createFirework(); // мгновенный первый залп
      try { fireworkSound.currentTime = 0; fireworkSound.play().catch(()=>{}); } catch(_) {}
      // Базовый темп залпов (будет адаптирован слушателем fanfare.play)
      fireworkInterval = setInterval(() => {
        createFirework();
        if (navigator.vibrate) { try { navigator.vibrate(80); } catch(_) {} }
        try { fireworkSound.currentTime = 0; fireworkSound.play().catch(()=>{}); } catch(_) {}
      }, isSmallScreen ? 6000 : 4000);

      // Подготовить элементы к разлёту: текстовый блок и кнопка (overlay не трансформируем — только плавно скрываем)
      const toDisperse = [];
      const textBlock = document.querySelector('.text-container'); if (textBlock) toDisperse.push(textBlock);
      // Персонажа НЕ разлетаем — он появится после клика
      const overlay = document.querySelector('.overlay');
      if (startBtn) toDisperse.push(startBtn);

      toDisperse.forEach((el, idx) => {
        // Случайные направления/углы
        const angle = Math.random() * Math.PI * 2;
        const dist = 200 + Math.random() * 600; // px
        const tx = Math.cos(angle) * dist;
        const ty = Math.sin(angle) * dist - window.innerHeight * 0.4; // вверх за экран
        const rz = (Math.random() * 80 - 40) + 'deg';
        el.style.setProperty('--tx', tx + 'px');
        el.style.setProperty('--ty', ty + 'px');
        el.style.setProperty('--rz', rz);
        el.classList.add('disperse');
      });

      // Плавно скрыть overlay без трансформаций (борьба с мерцанием фиксированных слоёв)
      if (overlay) {
        // Форсим reflow через rAF, чтобы transition сработал стабильно на мобиле
        requestAnimationFrame(() => {
          overlay.classList.add('overlay-fadeout');
          // Удалить после завершения перехода
          const removeOverlay = () => { try { overlay.remove(); } catch(_) {} };
          overlay.addEventListener('transitionend', removeOverlay, { once: true });
          // Фолбэк-таймер на случай, если событие не сработает
          setTimeout(removeOverlay, 550);
        });
      }

      // После анимации — удалить элементы интерфейса, затем показать персонажа по центру (появится и исчезнет)
      setTimeout(() => {
        toDisperse.forEach(el => { try { el.remove(); } catch(_) {} });
        if (characterEl) {
          characterEl.style.display = 'block';
          // Запустить появление в центре и исчезновение
          characterEl.classList.add('character-pop');
          // После завершения анимации — удалить персонажа
          characterEl.addEventListener('animationend', () => {
            try { characterEl.remove(); } catch(_) {}
          }, { once: true });
        }
      }, 1000);
    }

    

    // Конфетти
    function createConfetti() {
      const confetti = document.createElement('div');
      confetti.classList.add('confetti');
      confetti.style.left = Math.random() * 100 + 'vw';
      confetti.style.backgroundColor = ['red','yellow','white'][Math.floor(Math.random()*3)];
      confetti.style.animationDuration = (2 + Math.random() * 3) + 's';
      document.body.appendChild(confetti);
      setTimeout(() => confetti.remove(), 5000);
    }
    let confettiInterval = setInterval(createConfetti, isSmallScreen ? 600 : 300);

    // Салют
    function createFirework(particles = 40, radiusMax = 220) {
      const x = Math.random() * window.innerWidth;
      const y = Math.random() * window.innerHeight * 0.5;

      for (let i = 0; i < particles; i++) {
        const firework = document.createElement('div');
        firework.classList.add('firework');
        firework.style.left = x + 'px';
        firework.style.top = y + 'px';
        firework.style.background = FIREWORK_COLORS[Math.floor(Math.random()*FIREWORK_COLORS.length)];

        const angle = Math.random() * 2 * Math.PI;
        const radius = Math.random() * radiusMax;
        const dx = Math.cos(angle) * radius;
        const dy = Math.sin(angle) * radius;

        // Передаём смещение и угол через CSS-переменные для анимации и хвоста
        firework.style.setProperty('--dx', `${dx}px`);
        firework.style.setProperty('--dy', `${dy}px`);
        firework.style.setProperty('--angle', `${angle}rad`);
        // Длина хвоста пропорциональна дальности разлёта
        firework.style.setProperty('--tail', `${Math.max(100, radius)}px`);

        document.body.appendChild(firework);
        setTimeout(() => firework.remove(), 1800);
      }
    }

    // Управление взрывами по музыке
    function stopMusicBooms() {
      if (musicFireworkInterval) { clearInterval(musicFireworkInterval); musicFireworkInterval = null; }
      if (musicBigBoomInterval) { clearInterval(musicBigBoomInterval); musicBigBoomInterval = null; }
    }

    // На старте воспроизведения музыки усиливаем частоту салютов
    fanfare.addEventListener('play', () => {
      // Отключим базовый таймер, чтобы не было слишком много частиц
      if (fireworkInterval) { clearInterval(fireworkInterval); fireworkInterval = null; }

      stopMusicBooms();
      // Небольшие частые вспышки (примерно в такт)
      musicFireworkInterval = setInterval(() => {
        createFirework(isSmallScreen ? 16 : 24, isSmallScreen ? 110 : 140);
        try { fireworkSound.currentTime = 0; fireworkSound.play().catch(()=>{}); } catch(_) {}
      }, isSmallScreen ? 1200 : 800);
      // Периодические большие «залпы»
      musicBigBoomInterval = setInterval(() => {
        createFirework(isSmallScreen ? 50 : 80, isSmallScreen ? 200 : 280);
        try { fireworkSound.currentTime = 0; fireworkSound.play().catch(()=>{}); } catch(_) {}
      }, isSmallScreen ? 4200 : 3200);
    });

    // При паузе/окончании — остановить музыкальные взрывы и вернуть базовый темп
    fanfare.addEventListener('pause', () => {
      stopMusicBooms();
      if (!fireworkInterval) {
        fireworkInterval = setInterval(() => {
          createFirework();
          try { fireworkSound.currentTime = 0; fireworkSound.play().catch(()=>{}); } catch(_) {}
        }, isSmallScreen ? 6000 : 4000);
      }
    });
    fanfare.addEventListener('ended', () => {
      stopMusicBooms();
    });
  </script>
</body>
</html>
